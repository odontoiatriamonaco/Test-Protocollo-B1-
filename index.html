<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROTOCOLLO B1ONE Mobile</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- POP-UP AVVISI -->
<div id="alert-overlay">
  <div id="alert-box">
    <span id="alert-title">âš ï¸ Attenzione</span>
    <div id="alert-message"></div>
    <button id="alert-btn" onclick="closeCustomAlert()">OK</button>
  </div>
</div>

<!-- PASSWORD OVERLAY (NASCOSTO DEFAULT) -->
<div id="password-overlay" style="display:none;">
  <div id="password-box">
    <h2>Accesso Riservato</h2>
    <p>Inserisci la password per utilizzare il protocollo.</p>
    <input type="password" id="password-input" placeholder="Password" autofocus>
    <button onclick="checkPassword()">Accedi</button>
  </div>
</div>

<!-- DISCLAIMER OVERLAY (VISIBILE DEFAULT) -->
<div id="disclaimer-overlay" style="display:flex;">
  <div id="disclaimer-box">
    <div class="disclaimer-header">
       <h2>âš ï¸ Disclaimer Importante</h2>
    </div>
    <div class="disclaimer-body">
      <div class="disclaimer-text">
        <p><strong>Limitazione di ResponsabilitÃ :</strong> L'autore non si assume alcuna responsabilitÃ  per il risultato clinico derivante dall'uso di questo software. Le decisioni cliniche rimangono esclusiva responsabilitÃ  del professionista.</p>
        <p><strong>Scopo Didattico:</strong> Questo software Ã¨ fornito esclusivamente a scopo didattico e di studio. Ãˆ attualmente in fase di sviluppo (Beta).</p>
        <p><strong>Privacy e Dati:</strong> Tutti i dati inseriti rimangono esclusivamente sul tuo computer. Nessun dato viene trasmesso, registrato o salvato su server esterni, garantendo la massima privacy del paziente.</p>
      </div>
    </div>
    <div class="disclaimer-footer">
      <div class="disclaimer-check">
        <input type="checkbox" id="accept-check" onchange="toggleDisclaimerBtn()">
        <label for="accept-check">Ho letto, compreso e accetto le condizioni sopra riportate.</label>
      </div>
      <button onclick="acceptDisclaimer()" id="disclaimer-btn" disabled>Prosegui</button>
    </div>
  </div>
</div>

<!-- EDITOR -->
<div id="editor-overlay">
  <div class="editor-modal">
    <div class="editor-top-bar">
      <div class="editor-title">ğŸ›  Editor Protocolli</div>
      <div class="editor-actions">
        <button class="btn-blue" onclick="scaricaScriptCompleto()">ğŸ’¾ Salva Script Completo</button>
        <button class="btn-green" onclick="salvaProtocolliDB()">Salva Temp (Cache)</button>
        <button class="btn-red" onclick="chiudiEditor()">Chiudi</button>
      </div>
    </div>
    <div class="editor-filters">
      <div class="filter-item">
        <label>Seleziona Impianto:</label>
        <select id="edit-b1one" onchange="renderEditorTable()">
          <option value="High">B1One High</option>
          <option value="Medium">B1One Medium</option>
          <option value="Low">B1One Low</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Seleziona Diametro:</label>
        <select id="edit-diametro" onchange="renderEditorTable()">
          <option value="2.7">Ã˜ 2.7</option>
          <option value="3.2">Ã˜ 3.2</option>
          <option value="3.7">Ã˜ 3.7</option>
          <option value="4.2">Ã˜ 4.2</option>
          <option value="4.8">Ã˜ 4.8</option>
        </select>
      </div>
      <div class="filter-item" style="display:flex; align-items:flex-end;">
         <button onclick="ripristinaDefault()" style="background: linear-gradient(to bottom, #ffb74d, #f57c00); color: white; padding: 8px; font-size: 13px; border-bottom: 2px solid #e65100;" type="button">âš ï¸ Ripristina Originali</button>
      </div>
    </div>
    <div class="editor-content">
      <div id="editor-notes-container">
          <label>ğŸ“ Note Cliniche Generali (Comuni per questo tipo/diametro):</label>
          <textarea id="edit-general-notes" placeholder="Scrivi qui le note cliniche valide per tutto l'impianto selezionato..." onchange="updateGeneralNotes(this.value)"></textarea>
      </div>
      <table class="proto-table">
        <thead>
          <tr>
            <th width="10%">DensitÃ </th>
            <th width="15%">Carico</th>
            <th width="30%">Fresa / Sequenza</th>
            <th width="30%">Preparazione / Note</th>
            <th width="15%">Testa (opz.)</th>
          </tr>
        </thead>
        <tbody id="editor-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- ODONTOGRAMMA MODAL (per sintesi finale) -->
<div id="odonto-overlay">
    <div class="editor-modal" style="background:#555; width:100%; height:100%;">
        <div class="editor-top-bar">
            <div class="editor-title">ğŸ¦· Sintesi Odontogramma</div>
            <div class="editor-actions">
                <button class="btn-green" onclick="esportaOdontogrammaPDF()">ğŸ“„ Scarica PDF Orizzontale</button>
                <button class="btn-red" onclick="closeOdonto()">Chiudi</button>
            </div>
        </div>
        <div class="odonto-content" style="display:flex; justify-content:center; background:#888; padding:20px;">
            <div id="odonto-sheet">
                <div style="text-align:center; margin-bottom:20px;">
                    <h1 style="color:#0056b3; margin:0; font-size:24px;">SINTESI PREPARAZIONE IMPIANTI</h1>
                    <p id="odonto-patient-name" style="font-size:18px; font-weight:bold; color:#333; margin-top:5px;"></p>
                    <p style="font-size:14px; color:#666;">PROTOCOLLO B1ONE Mobile</p>
                </div>

                <div class="arch-label">Arcata Superiore</div>
                <div id="grid-upper" class="odonto-grid"></div>

                <div class="arch-label" style="margin-top:30px;">Arcata Inferiore</div>
                <div id="grid-lower" class="odonto-grid" style="border-bottom:none; border-top:2px solid #333; padding-top:20px;"></div>
                
                <div style="margin-top:40px; display:flex; flex-direction:column; align-items:center;">
                    <div class="legend-box">
                        <span style="font-weight:bold; margin-right:10px;">Legenda DensitÃ :</span>
                        <div class="legend-item"><div class="legend-dot" style="background:#ffcdd2;"></div> D1 (Osso Duro)</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#ffe0b2;"></div> D2 (Medio-Duro)</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#fff9c4;"></div> D3 (Medio-Tenero)</div>
                        <div class="legend-item"><div class="legend-dot" style="background:#c8e6c9;"></div> D4 (Osso Tenero)</div>
                    </div>
                    <div style="margin-top: 8px; font-size:12px; color:#666;">
                        Legenda: Cerchio = Tipo + Ã˜ Impianto (sopra) / L. Impianto (sotto) | Testo esterno = Fresa Finale & Lunghezza Stop
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<header>
  <h1>PROTOCOLLO B1ONE</h1>
  <p>Ideato dal Dr. Maurizio Monaco</p>
  <p style="color:white; font-size:13px; margin-top:4px;">ğŸ”’ I dati restano nel browser dell'utente</p>
</header>

<div id="finestraContatti" style="display:none; position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: white; border: 2px solid #007acc; padding: 20px 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 9999; text-align: center;">
  <h3>ğŸ“¬ Contatti</h3>
  <p>Per qualsiasi informazione o dubbio contattare:<br><strong><a href="mailto:odontoiatria.monaco@gmail.com" style="color:#007acc;">odontoiatria.monaco@gmail.com</a></strong></p>
  <button onclick="nascondiContatti()" style="margin-top: 10px; padding: 6px 12px; background: linear-gradient(to bottom, #ff5b68, #dc3545); color: white; border: none; border-radius: 4px; border-bottom: 2px solid #bd2130; cursor: pointer;">Chiudi</button>
</div>

<div class="container">
  <div class="form-group">
    <label for="nome">Cognome e Nome del paziente:</label>
    <input type="text" id="nome" placeholder="Inserisci cognome e nome">
  </div>
  
  <!-- IMPORT PDF REALGUIDE -->
  <div class="import-pdf-section">
    <div class="import-pdf-header">
      <span class="import-icon">ğŸ“„</span>
      <span class="import-title">Importa da Report Implantare</span>
    </div>
    <p class="import-description">Carica il PDF del report implantare (RealGuide, BlueSkyBio, coDiagnostix, ecc.) per compilare automaticamente i dati.</p>
    <div class="import-actions">
      <label class="btn-import">
        ğŸ“¥ Seleziona PDF Report
        <input type="file" id="pdf-import" accept=".pdf" onchange="importaPDFReport(event)" style="display:none;">
      </label>
      <button type="button" class="btn-import-help" onclick="mostraAiutoPDF()">â“ Formati supportati</button>
    </div>
    <div id="pdf-import-status" class="import-status"></div>
  </div>

  <!-- ODONTOGRAMMA DIGITALE STILIZZATO -->
  <div class="odontogramma-digitale">
    <div class="odonto-digital-header">
      <h3>Odontogramma Digitale</h3>
      <div class="odonto-status">Stato: <span id="odonto-stato">Pronto</span></div>
    </div>
    
    <div class="arcade-section">
      <div class="arcade-title">ARCATA SUPERIORE</div>
      <div class="teeth-row-wrapper">
        <div class="teeth-row quadrant" id="selector-upper-right"></div>
        <div class="quadrant-divider"></div>
        <div class="teeth-row quadrant" id="selector-upper-left"></div>
      </div>
    </div>
    
    <div class="arcade-section">
      <div class="arcade-title">ARCATA INFERIORE</div>
      <div class="teeth-row-wrapper">
        <div class="teeth-row quadrant" id="selector-lower-right"></div>
        <div class="quadrant-divider"></div>
        <div class="teeth-row quadrant" id="selector-lower-left"></div>
      </div>
    </div>
    
    <div class="selection-summary-new">
      <span class="summary-badge"><span id="selection-count">0</span> impianti</span>
      <span class="summary-detail">Selezionati: <span id="selection-list">nessuno</span></span>
    </div>
  </div>

  <!-- Campi nascosti per compatibilitÃ  -->
  <input type="hidden" id="impianti" value="">
  <div id="selector-upper" style="display:none;"></div>
  <div id="selector-lower" style="display:none;"></div>

  <div id="impianti-container"></div>

  <div class="button-container">
    <input type="file" id="fileInput" accept=".json" style="display:none" onchange="caricaDati(event)" onclick="this.value=null">
    <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ Carica Dati</button>
    <button id="saveBtn" onclick="salvaDati()">ğŸ’¾ Salva Dati</button>
    <button id="elaboraBtn" onclick="elabora()">ELABORA</button>
    <button id="commonDrillBtn" onclick="calcolaFresaComune()">ğŸ”„ Raggruppa Preparazione</button>
    <button id="odontoBtn" onclick="mostraOdontogramma()" style="display:none;">ğŸ¦· Sintesi Odontogramma</button>
    <button id="resetBtn" onclick="resetta()">RESET</button>
    <button id="pdfBtn" onclick="esportaPDF()">ESPORTA PDF</button>
    <div style="width: 100%; text-align: center; margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
      <button id="b1oneInfoBtn" onclick="window.open('https://youtube.com/playlist?list=PL2KSU2Q5dpN96IummPSUDUAgjX39-qbBs&si=qXBBy7PkfYo984Bi', '_blank')">
        ğŸ¥ Conoscere il B1ONE
      </button>
      <button id="kitPrepBtn" onclick="window.open('Kit di frese.pdf', '_blank')" style="font-weight: bold; background: linear-gradient(to bottom, #ab47bc, #7b1fa2); color: white; border-bottom: 3px solid #4a148c;">
        ğŸ“¥ Kit Preparazione
      </button>
    </div>
  </div>

  <div id="output">
    <p style="font-size: 13px; font-style: italic; color: #555; margin-top: 25px; text-align: center;">
      âš ï¸ Questo software Ã¨ in fase <strong>beta</strong>. L'ideatore, Dr. Maurizio Monaco, <strong>non si assume alcuna responsabilitÃ </strong> clinica.
    </p>
  </div>

  <div style="text-align:right; margin-top:10px;">
    <button onclick="mostraLogin()" style="font-size:13px; padding:5px 10px; background: linear-gradient(to bottom, #777, #555); border-bottom: 2px solid #333;" type="button">ğŸ”’ Accesso Admin</button>
  </div>

  <div id="loginBox" style="display:none; margin-top:10px;">
    <input id="adminPass" type="password" placeholder="Password Admin" style="padding:6px; margin-right:4px;">
    <button onclick="verificaLogin()" style="padding:6px;">Entra</button>
  </div>

  <div id="adminArea" style="display:none; margin-top:20px; padding:15px; background:#fff4e6; border:1px solid #ffcc80; border-radius:8px;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0; color:#333;">Area Amministratore</h3>
        <button onclick="apriEditor()" style="background: linear-gradient(to bottom, #26c6da, #0097a7); color: white; border-bottom: 3px solid #006064;" type="button">ğŸ›  Editor Protocolli</button>
    </div>
    <p style="margin-top:10px;">ğŸ‘ï¸â€ğŸ—¨ï¸ Accessi: <span id="accessiCount">0</span> | ğŸ¦· Impianti: <span id="impiantiCount">0</span></p>
  </div>
</div>

<div style="position: fixed; bottom: 20px; right: 20px; z-index: 999;">
  <button onclick="mostraContatti()" style="background: linear-gradient(to bottom, #4CAF50, #388E3C); color: white; padding: 10px 16px; border: none; border-radius: 6px; font-weight: bold; font-size: 14px; cursor: pointer; border-bottom: 3px solid #1B5E20;" type="button">
    ğŸ“¬ Contatti
  </button>
</div>
<div style="position: fixed; bottom: 20px; left: 20px; z-index: 999;">
  <a href="Tutorial.pdf" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">
    <button style="background: linear-gradient(to bottom, #ff9800, #f57c00); color: white; padding: 10px 16px; border: none; border-radius: 6px; font-weight: bold; font-size: 14px; cursor: pointer; border-bottom: 3px solid #e65100;" type="button">
      ğŸ“„ Istruzioni
    </button>
  </a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
